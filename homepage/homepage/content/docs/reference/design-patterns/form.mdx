export const metadata = {
  description: "Learn how to handle forms in Jazz for creating and updating CoValues."
};

import { Alert, CodeGroup, TabbedCodeGroup, TabbedCodeGroupItem, VanillaLogo, ReactLogo, SvelteLogo, RNLogo, ExpoLogo, FileName } from "@/components/forMdx";

# How to write forms with Jazz

This guide shows you a simple and powerful way to implement forms for creating and updating CoValues.

[See the full example here.](https://github.com/garden-co/jazz/tree/main/examples/form)

## Updating a CoValue

To update a CoValue, we use the `$jazz.set` method directly to update the CoValue with the new data as it changes. These changes are synced across all connected clients in real time.

<TabbedCodeGroup default="react" savedPreferenceKey="framework" id="tcg-form-updating">
  <TabbedCodeGroupItem icon={<VanillaLogo />} label="Vanilla" value="vanilla" preferWrap>
```tsx index.ts#Basic 
  ```
  </TabbedCodeGroupItem>
<TabbedCodeGroupItem icon={<ReactLogo />} label="React" value="react" preferWrap>
```tsx index.tsx#Basic
```
</TabbedCodeGroupItem>
<TabbedCodeGroupItem icon={<SvelteLogo />} label="Svelte" value="svelte" preferWrap>
```svelte UpdateCoValue.svelte
```
</TabbedCodeGroupItem>
<TabbedCodeGroupItem icon={<RNLogo />} label="React Native" value="react-native" preferWrap>
```tsx index.tsx#BasicRN
```
</TabbedCodeGroupItem>
<TabbedCodeGroupItem icon={<ExpoLogo />} label="Expo" value="react-native-expo" preferWrap>
```tsx index.tsx#BasicRN
```
</TabbedCodeGroupItem>
</TabbedCodeGroup>

## Creating a CoValue

We may want to create the CoValue early (for example, to save as a draft), even if we are not ready to fill all the mandatory fields yet. We can use the `.partial()` method to create the CoValue, and add data incrementally until it's ready to be saved.

### Using a Partial CoValue

Rather than setting `.optional()` on every field in the schema, we can use the `.partial()` method to mark all fields as optional on an existing schema. This is useful when we want to create a CoValue, but we're not ready to fill all the mandatory fields yet.

Let's say we have a CoValue called `BubbleTeaOrder`. We can create a partial version,
`PartialBubbleTeaOrder`, which will allow us to create a form to fill fields incrementally until the order is ready to be submitted.

<FileName>schema.ts</FileName>
<CodeGroup>
```ts schema.ts
```
</CodeGroup>

## Writing the components

Let's write the form component that will be used for both creating and updating our order.

<TabbedCodeGroup default="react" savedPreferenceKey="framework" id="tcg-order-form">
  <TabbedCodeGroupItem icon={<VanillaLogo />} label="Vanilla" value="vanilla" preferWrap>
```tsx index.ts#OrderForm 
  ```
  </TabbedCodeGroupItem>
<TabbedCodeGroupItem icon={<ReactLogo />} label="React" value="react" preferWrap>
```tsx OrderForm.tsx#OrderForm
```
</TabbedCodeGroupItem>
<TabbedCodeGroupItem icon={<SvelteLogo />} label="Svelte" value="svelte" preferWrap>
```svelte OrderForm.svelte
```
</TabbedCodeGroupItem>
<TabbedCodeGroupItem icon={<RNLogo />} label="React Native" value="react-native" preferWrap>
```tsx OrderForm.tsx#OrderFormRN
```
</TabbedCodeGroupItem>
<TabbedCodeGroupItem icon={<ExpoLogo />} label="Expo" value="react-native-expo" preferWrap>
```tsx OrderForm.tsx#OrderFormRN
```
</TabbedCodeGroupItem>
</TabbedCodeGroup>

### Writing the edit form

To make the edit form, simply pass the `BubbleTeaOrder`. Changes are automatically saved as you type.

<TabbedCodeGroup default="react" savedPreferenceKey="framework" id="tcg-edit-form">
  <TabbedCodeGroupItem icon={<VanillaLogo />} label="Vanilla" value="vanilla" preferWrap>
```tsx index.ts#EditForm
  ```
  </TabbedCodeGroupItem>
<TabbedCodeGroupItem icon={<ReactLogo />} label="React" value="react" preferWrap>
```tsx OrderForm.tsx#EditForm
```
</TabbedCodeGroupItem>
<TabbedCodeGroupItem icon={<SvelteLogo />} label="Svelte" value="svelte" preferWrap>
```svelte EditForm.svelte
```
</TabbedCodeGroupItem>
<TabbedCodeGroupItem icon={<RNLogo />} label="React Native" value="react-native" preferWrap>
```tsx OrderForm.tsx#EditForm
```
</TabbedCodeGroupItem>
<TabbedCodeGroupItem icon={<ExpoLogo />} label="Expo" value="react-native-expo" preferWrap>
```tsx OrderForm.tsx#EditForm
```
</TabbedCodeGroupItem>
</TabbedCodeGroup>

<Alert variant="info" title="Note" className="mt-4">
In a lot of cases, automatically saving as you type may not be what you want. For example, you may not want people to see the 'interim states' as you prepare your changes. In that case, [scroll down](#editing-with-a-save-button) to see how to use branching to create an isolated copy of the order that you can work on, and merge when you're ready.
</Alert>

### Writing the create form

For the create form, we need to:
1. Create a partial order.
2. Edit the partial order.
3. Convert the partial order to a "real" order on submit.

Here's how that looks:

<TabbedCodeGroup default="react" savedPreferenceKey="framework" id="tcg-create-form">
  <TabbedCodeGroupItem icon={<VanillaLogo />} label="Vanilla" value="vanilla" preferWrap>
```tsx index.ts#CreateForm
  ```
  </TabbedCodeGroupItem>
<TabbedCodeGroupItem icon={<ReactLogo />} label="React" value="react" preferWrap>
```tsx OrderForm.tsx#CreateOrder
```
</TabbedCodeGroupItem>
<TabbedCodeGroupItem icon={<SvelteLogo />} label="Svelte" value="svelte" preferWrap>
```svelte CreateForm.svelte
```
</TabbedCodeGroupItem>
<TabbedCodeGroupItem icon={<RNLogo />} label="React Native" value="react-native" preferWrap>
```tsx index.ts#CreateForm
```
</TabbedCodeGroupItem>
<TabbedCodeGroupItem icon={<ExpoLogo />} label="Expo" value="react-native-expo" preferWrap>
```tsx index.ts#CreateForm
```
</TabbedCodeGroupItem>
</TabbedCodeGroup>

## Editing with a save button

If you would rather prepare your changes locally, and only save them when you're ready, you can use Jazz's branching feature to create a private branch for editing that can be merged back when the user has finished editing.

<TabbedCodeGroup default="react" savedPreferenceKey="framework" id="tcg-edit-form-branch">
  <TabbedCodeGroupItem icon={<VanillaLogo />} label="Vanilla" value="vanilla" preferWrap>
```tsx index.ts#EditFormWithSave
  ```
  </TabbedCodeGroupItem>
<TabbedCodeGroupItem icon={<ReactLogo />} label="React" value="react" preferWrap>
```tsx OrderForm.tsx#EditOrderWithSave
```
</TabbedCodeGroupItem>
<TabbedCodeGroupItem icon={<SvelteLogo />} label="Svelte" value="svelte" preferWrap>
```svelte EditOrderWithSave.svelte
```
</TabbedCodeGroupItem>
<TabbedCodeGroupItem icon={<RNLogo />} label="React Native" value="react-native" preferWrap>
```tsx OrderForm.tsx#EditOrderWithSave
```
</TabbedCodeGroupItem>
<TabbedCodeGroupItem icon={<ExpoLogo />} label="Expo" value="react-native-expo" preferWrap>
```tsx OrderForm.tsx#EditOrderWithSave
```
</TabbedCodeGroupItem>
</TabbedCodeGroup>

***Note**: branches are identified by a combination of their **name** and **owner**. In the example above, we create a new group on every page load in order to create a distinct branch, even though the name remains the same. Otherwise, the branch would be created with the current user as the owner. This would result in the same branch being reloaded on every page load, as the name and owner would match an existing branch.*

This approach creates a private branch using `unstable_branch` with a unique owner group. The user can edit the branch without affecting the original data, and changes are only persisted when they click save via `unstable_merge()`.

<Alert variant="info" className="mt-4 flex gap-2 items-center">
  <strong>Important:</strong> Version control is currently unstable and we may ship breaking changes in patch releases.
</Alert>


## Handling different types of data

Forms can be more complex than just a single string field, so we've put together an example app that shows you
how to handle single-select, multi-select, date, boolean inputs, and rich text.

[See the full example here.](https://github.com/garden-co/jazz/tree/main/examples/form)
