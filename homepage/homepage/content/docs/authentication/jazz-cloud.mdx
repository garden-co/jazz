export const metadata = { title: "Jazz Cloud Authentication" };

import { CodeGroup, ContentByFramework } from "@/components/forMdx";
import { Alert } from "@garden-co/design-system/src/components/atoms/Alert";


# Jazz Cloud Authentication

[Jazz Cloud](/cloud) provides an authentication service that allows you to manage user accounts and 
authentication for your apps. This integration allows users to sign up or sign in through your
Jazz application, using authentication infrastructure managed by us.


## How it works

Jazz Cloud Authentication works by providing a set of APIs that your application can use to authenticate users. 
These APIs are designed to be used in conjunction with the [Jazz Cloud Dashboard](https://dashboard.jazz.tools/), 
which provides a user interface for configuring managed [Better Auth](https://www.better-auth.com/) 
servers for your application.

<Alert variant="info" title="Network requirements">
This authentication method is not fully local-first, as login and signup need to be done online,
but once authenticated, users can use all of Jazz's features without needing to be online.
</Alert>

## Key benefits

- **Developer-friendly**: Easy integration and setup.
- **Methods supported**: Email & password and OAuth providers supported out-of-the-box.
- **Key management**: Users keys are securely stored in Jazz Cloud, so they don't risk losing access to their accounts.

## Getting started

### 1. Sign into Jazz Cloud

If you don't already have a Jazz Cloud account, create one in the [Jazz Cloud Dashboard](https://dashboard.jazz.tools).

### 2. Create an App

Create an App in the Jazz Cloud Dashboard.
This will create a default development environment for your application, an API Key and an authentication URL.
Take note of the `API Key` and `Authentication URL`, as you will need them in the next steps.

### 3. Installation

<ContentByFramework framework={["react", "react-native-expo"]}>
  <CodeGroup>
    ```sh
    pnpm add jazz-react-auth-betterauth
    ```
  </CodeGroup>
</ContentByFramework>

<ContentByFramework framework={["vanilla"]}>
  <CodeGroup>
    ```sh
    pnpm add jazz-auth-betterauth
    ```
  </CodeGroup>
</ContentByFramework>


### 4. Configure the Auth Provider

<ContentByFramework framework={["react", "react-native-expo"]}>
  <CodeGroup>
    ```tsx twoslash
    import * as React from "react";
    declare const authUrl: string;
    // ---cut---
    // src/components/JazzAndAuth.tsx
    import { JazzProvider } from "jazz-react";
    import { AuthProvider } from "jazz-react-auth-betterauth";
    import { type ReactNode } from "react";

    interface Props {
      children: ReactNode;
    }

    // @annotate: Set the base URL to the authentication URL as specified in the Jazz Cloud Dashboard.
    
    export function JazzAndAuth({ children }: Props) {
      return (
        <JazzProvider
          sync={{
            peer: "wss://cloud.jazz.tools/?key=<YOUR_API_KEY>",
          }}
        >
          <AuthProvider
            options={{

              baseURL: "https://auth.jazz.tools/<YOUR_API_KEY>/api/auth/"
            }}
          >
            {children}
          </AuthProvider> 
        </JazzProvider>
      );
    }
    ```
  </CodeGroup>
</ContentByFramework>

<ContentByFramework framework={["vanilla"]}>
  <CodeGroup>
    ```tsx twoslash filename="src/lib/auth.ts"
    declare const authUrl: string;
    declare const userName: string;
    declare const userEmail: string;
    declare const userPassword: string;
    // ---cut---
    // src/lib/auth.ts
    const authenticate = async () => {};
    import { AuthSecretStorage } from "jazz-tools";
    const storage = new AuthSecretStorage();
    import { BetterAuth } from "jazz-auth-betterauth";

    // @annotate: Set the base URL to the authentication URL as specified in the Jazz Cloud Dashboard.
    
    export const auth = new BetterAuth(authenticate, storage, { 
      baseURL: "https://auth.jazz.tools/<YOUR_API_KEY>/api/auth/" 
    });
    ```
  </CodeGroup>
</ContentByFramework>



### 5. Sign up and Sign in

Unlike other authentication providers, `jazz-react-auth-betterauth`  does not provide a default 
authentication UI, so you will need to implement your own.
You can check out our [better-auth example project](https://github.com/garden-co/jazz/tree/main/examples/betterauth) 
for inspiration.

<ContentByFramework framework={["react", "react-native-expo"]}>
  <CodeGroup>
    ```tsx twoslash
    import * as React from "react";
    declare const userName: string;
    declare const userEmail: string;
    declare const userPassword: string;
    declare const auth: ReturnType<typeof useAuth>;
    // ---cut---
    import { useAuth } from "jazz-react-auth-betterauth";

    function AuthenticationPage(){
      const auth = useAuth();

      // [...] Your Authentication UI
    }

    // @annotate: Sign up with email & password

    await auth.authClient.signUp.email({
      name: userName,
      email: userEmail,
      password: userPassword,
    }, {
      onSuccess: async () => {
        // Note: This is required to load the user's account keys from Jazz Cloud.
        await auth.signIn();
      }
    });

    // @annotate: Sign in with email & password

    await auth.authClient.signIn.email({
      email: userEmail,
      password: userPassword
    }, {
      onSuccess: async () => {
        // Note: This is required to load the user's account keys from Jazz Cloud.
        await auth.logIn();
      }
    });
    ```
  </CodeGroup>
</ContentByFramework>

<ContentByFramework framework={["vanilla"]}>
  <CodeGroup>
    ```tsx twoslash filename="src/main.ts"
    // @noErrors: 2307
    declare const userName: string;
    declare const userEmail: string;
    declare const userPassword: string;
    import { BetterAuth } from "jazz-auth-betterauth";
    declare const auth: BetterAuth<{baseURL: string}>;
    // ---cut---
    // src/main.ts
    import { auth } from "./lib/auth";

    // @annotate: Sign up with email & password

    await auth.authClient.signUp.email({
      name: userName,
      email: userEmail,
      password: userPassword,
    }, {
      onSuccess: async () => {
        // Note: This is required to load the user's account keys from Jazz Cloud.
        await auth.signIn();
      }
    });

    // @annotate: Sign in with email & password

    await auth.authClient.signIn.email({
      email: userEmail,
      password: userPassword
    }, {
      onSuccess: async () => {
        // Note: This is required to load the user's account keys from Jazz Cloud.
        await auth.logIn();
      }
    });
    ```
  </CodeGroup>
</ContentByFramework>

Jazz Cloud Authentication is based on [Better Auth](https://www.better-auth.com/), please refer
to the [Better Auth documentation](https://www.better-auth.com/docs/basic-usage) for more information
on how to use the authentication client.


## Social Sign-On

To integrate social sign-on into your application, configure the social provider's credentials
in the Jazz Cloud Dashboard. Once configured, you may trigger social-sign on using the authentication client.

<CodeGroup>
  ```tsx twoslash
  import { useBetterAuth } from "jazz-react-auth-betterauth";
  declare const authUrl: string;
  const auth = useBetterAuth({ baseURL: authUrl });
  const providerName = "github" as Parameters<typeof auth.authClient.signIn.social>[0]["provider"];
  // ---cut---
  // @annotate: Sign-in with SSO provider

  await auth.authClient.signIn.social({
    provider: providerName,
  });

  ```
</CodeGroup>

## Self-hosting

You can self-manage authentication by using the Better Auth Jazz plugin. 

We are in the process of writing better documentation for this, but in the meantime you can check out 
the [Better Auth Example](https://github.com/garden-co/jazz/tree/main/plugins/betterauth) as a reference.


## Additional resources

- [Better Auth documentation](https://www.better-auth.com/docs/introduction)
