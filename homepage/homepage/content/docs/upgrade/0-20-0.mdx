import { Alert, CodeGroup } from '@/components/forMdx'

# Jazz 0.20.0 - Full native crypto

With this release, we complete our migration to a pure **native** Rust toolchain.
We have removed the JavaScript compatibility layer, meaning our native Rust core now runs everywhere: React Native, Edge runtimes, all server-side environments, and the web.

## Motivation

Before 0.20.0, Jazz relied on a JavaScript crypto implementation to work around compatibility issues in some runtimes-most notably React Native.
As a result, our native Rust core wasn’t running in React Native and, on some Edge runtimes, 
only worked when WASM was explicitly initialized (see [WASM on Edge runtimes](/docs/react/server-side/setup#wasm-on-edge-runtimes)).

The JavaScript crypto implementation is much slower than native Rust crypto. Although workarounds like RNQuickCrypto for React Native improved performance, they still only wrapped certain native libraries, rather than running Jazz's full Rust crypto.

With native Rust crypto now running everywhere, Jazz comes with good performance in every platform. 
This also helps us speed up the migration of Jazz Core to Rust which will help us improve the Jazz overall performance.

## What changed

- We dropped support for `PureJSCrypto`. Jazz crypto now runs natively in each environment.
- We dropped support for `RNQuickCrypto`. RNCrypto is now the default crypto provider on React Native.
- There is no more fallback to Javascript crypto. If the crypto fails to initialize, it will throw an error. 
**NB**: if you use WASM crypto on Edge runtimes, you need to ensure that WASM is available and initialized. See more details at [WASM on Edge runtimes](/docs/react/server-side/setup#wasm-on-edge-runtimes).

## Breaking changes

### Edge runtimes

If you use WASM crypto on Edge runtimes, you need to ensure that WASM is available and initialized, there is no more fallback to Javascript crypto. 
See more details at [WASM on Edge runtimes](/docs/react/server-side/setup#wasm-on-edge-runtimes).

<CodeGroup>
```ts
import "jazz-tools/load-edge-wasm";
// Other Jazz Imports

export default {
  async fetch(request: Request, env: Env, ctx: ExecutionContext) {
    // Jazz application logic
    return new Response("Hello from Jazz on Cloudflare!");
  },
};
```
</CodeGroup>

if you don't do this, you will get an error like this:

<CodeGroup>
```
Critical Error: Failed to load WASM module

You need to add \`import "jazz-tools/load-edge-wasm";\` on top 
of your entry module to make Jazz work with this runtime 

A native crypto module is required for Jazz to work. 
See https://jazz.tools/docs/react/reference/performance#use-the-best-crypto-implementation-for-your-platform 
for possible alternatives.
```
</CodeGroup>

Before 0.20.0, you would get a warning like this:
<CodeGroup>
```
Warning: WASM crypto is not available. Falling back to JavaScript crypto.
```
</CodeGroup>

### Expo

1) If you use Expo, you need to install `cojson-core-rn` and make sure the version matches `jazz-tools`. `cojson-core-rn` is our new high-performance crypto provider for Expo, and it is **required** for Expo applications.

<CodeGroup>
```bash
npm install cojson-core-rn
```
</CodeGroup>

<CodeGroup>
```json
"dependencies": {
  "cojson-core-rn": "x.x.x", # same version as jazz-tools
  "jazz-tools": "x.x.x" # same version as cojson-core-rn
}
```
</CodeGroup>

<Alert variant="warning" title="Versioning" className="mt-4">
  While you can distribute your own JS code changes OTA, as the Jazz versions must be kept the same for both the JS and the native dependencies, if you updates your Jazz version, this *cannot* be distributed over the air, and requires a new store submission.
</Alert>

See also: [Expo setup](/docs/react-native-expo/project-setup).

2) **Remove QuickCrypto dependencies/config** (only if you previously added them for `RNQuickCrypto`):

- Remove `react-native-quick-crypto` (and any associated config you added for it).
- Remove any `SODIUM_ENABLED` / `sodiumEnabled` settings you added specifically for QuickCrypto.

3) **Remove `CryptoProvider` entirely** (RNCrypto is now the default)

After installing `cojson-core-rn`, you have to remove the `CryptoProvider` option, it is no longer supported:

<CodeGroup>
```tsx
import { JazzExpoProvider } from "jazz-tools/expo";
import { MyAppAccount } from "./schema";

const apiKey = "you@example.com";

export function MyJazzProvider({ children }: { children: React.ReactNode }) {
  return (
    <JazzExpoProvider
      sync={{ peer: `wss://cloud.jazz.tools/?key=${apiKey}` }}
      AccountSchema={MyAppAccount}
    >
      {children}
    </JazzExpoProvider>
  );
}
```
</CodeGroup>

### React Native (non-Expo)

If you use React Native, you need to install `cojson-core-rn` and make sure the version matches `jazz-tools`. `cojson-core-rn` is our new high-performance crypto provider for React Native. 
If you use React Native, you need to install `cojson-core-rn` and make sure the version matches `jazz-tools`. `cojson-core-rn` is our new high-performance crypto provider for React Native, and it is **required** for React Native applications.

1) **Install `cojson-core-rn` (required)** and make sure the version matches `jazz-tools`:

<CodeGroup>
```bash
npm install cojson-core-rn
```
</CodeGroup>

<CodeGroup>
```json
"dependencies": {
  "cojson-core-rn": "x.x.x", # same version as jazz-tools
  "jazz-tools": "x.x.x" # same version as cojson-core-rn
}
```
</CodeGroup>

<Alert variant="warning" title="Versioning" className="mt-4">
  While you can distribute your own JS code changes OTA, as the Jazz versions must be kept the same for both the JS and the native dependencies, if you updates your Jazz version, this *cannot* be distributed over the air, and requires a new store submission.
</Alert>

See also: [React Native setup](/docs/react-native/project-setup).

2) **Remove QuickCrypto dependencies/config** (only if you previously added them for `RNQuickCrypto`):

- Remove `react-native-quick-crypto` (and any associated config you added for it).
- Remove any `SODIUM_ENABLED` / `sodiumEnabled` settings you added specifically for QuickCrypto.

3) **Remove `CryptoProvider` entirely** (RNCrypto is now the default)

After installing `cojson-core-rn`, you have to remove the `CryptoProvider` option, it is no longer supported:

<CodeGroup>
```tsx
import { JazzReactNativeProvider } from "jazz-tools/react-native";
import { MyAppAccount } from "./schema";

const apiKey = "you@example.com";

export function MyJazzProvider({ children }: { children: React.ReactNode }) {
  return (
    <JazzReactNativeProvider
      sync={{ peer: `wss://cloud.jazz.tools/?key=${apiKey}` }}
      AccountSchema={MyAppAccount}
    >
      {children}
    </JazzReactNativeProvider>
  );
}
```
</CodeGroup>

