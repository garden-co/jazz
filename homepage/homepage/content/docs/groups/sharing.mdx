export const metadata = { 
  description: "Share CoValues in Jazz through public sharing and invite links. Enable collaboration by granting access to everyone or specific users with different permission levels."
};

import { ContentByFramework, CodeGroup } from '@/components/forMdx'

# Public sharing and invites

## Public sharing

You can share CoValues publicly by setting the `owner` to a `Group`, and granting
access to "everyone".

<CodeGroup>
  ```ts
  const group = Group.create();
  group.addMember("everyone", "writer"); // *highlight*
  ```
</CodeGroup>

This is done in the [chat example](https://github.com/garden-co/jazz/tree/main/examples/chat) where anyone can join the chat, and send messages.

You can also [add members by Account ID](/docs/groups/intro#adding-group-members-by-id).

## Invites

You can grant users access to a CoValue by sending them an invite link.

This is used in the [pet example](https://github.com/garden-co/jazz/tree/main/examples/pets)
and the [todo example](https://github.com/garden-co/jazz/tree/main/examples/todo).

<ContentByFramework  framework="react">
<CodeGroup>
```ts
import { createInviteLink } from "jazz-react";

createInviteLink(organization, "writer"); // or reader, or admin
```
</CodeGroup>
</ContentByFramework>

<ContentByFramework  framework="react-native">
<CodeGroup>
```ts
import { createInviteLink } from "jazz-react-native";

createInviteLink(organization, "writer"); // or reader, or admin
```
</CodeGroup>
</ContentByFramework>

<ContentByFramework  framework="react-native-expo">
<CodeGroup>
```ts
import { createInviteLink } from "jazz-expo";

createInviteLink(organization, "writer"); // or reader, or admin
```
</CodeGroup>
</ContentByFramework>

<ContentByFramework  framework="vue">
<CodeGroup>
```ts
import { createInviteLink } from "jazz-vue";

createInviteLink(organization, "writer"); // or reader, or admin
```
</CodeGroup>
</ContentByFramework>

<ContentByFramework  framework="svelte">
<CodeGroup>
```ts
import { createInviteLink } from "jazz-browser";

createInviteLink(organization, "writer"); // or reader, or admin
```
</CodeGroup>
</ContentByFramework>

It generates a URL that looks like `.../invite/[CoValue ID]/[inviteSecret]`

In your app, you need to handle this route, and let the user accept the invitation,
as done [here](https://github.com/garden-co/jazz/tree/main/examples/pets/src/2_main.tsx).

<CodeGroup>
```ts
useAcceptInvite({
  invitedObjectSchema: PetPost,
  onAccept: (petPostID) => navigate("/pet/" + petPostID),
});
```
</CodeGroup>


### Requesting Invites

To allow a non-group member to request an invitation to a group you can use the `writeOnly` role.
This means that users only have write access to a specific requests list (they can't read other requests). 
However, Administrators can review and approve these requests.

Create the data models.

<CodeGroup>
```ts twoslash
import { CoMap, co, CoValue, Account, CoList } from "jazz-tools";
// ---cut-before---
class JoinRequest extends CoMap {
  account = co.ref(Account);
  status = co.literal("pending", "approved", "rejected");
}

class RequestsList extends CoList.Of(co.ref(JoinRequest)) {};
```
</CodeGroup>

Set up the request system with appropriate access controls.

<CodeGroup>
```ts twoslash
import { Group, co, CoList, CoMap, Account } from "jazz-tools";
import { createInviteLink } from "jazz-react";

export class JoinRequest extends CoMap {
  account = co.ref(Account);
  status = co.literal("pending", "approved", "rejected");
}

export class RequestsList extends CoList.Of(co.ref(JoinRequest)) {};

// ---cut-before---
function createRequestsToJoin() {
  const requestsGroup = Group.create();
  requestsGroup.addMember("everyone", "writeOnly");

  return RequestsList.create([], requestsGroup);
}

async function sendJoinRequest(
  requestsList: RequestsList,
  account: Account,
) {
  const request = JoinRequest.create(
    {
      account,
      status: "pending",
    },
    requestsList._owner // Inherit the access controls of the requestsList
  );

  requestsList.push(request);

  return request;
}
```
</CodeGroup>

Using the write-only access users can submit requests that only administrators can review and approve.

<CodeGroup>
```ts twoslash
import { co, CoMap, CoList, ID, Account, Group, Resolved } from "jazz-tools";

class JoinRequest extends CoMap {
  account = co.ref(Account);
  status = co.string; // Can be "pending", "approved", "rejected"
}

export class RequestsList extends CoList.Of(co.ref(JoinRequest)) {};

export class RequestsToJoin extends CoMap {
  writeOnlyInvite = co.string;
  requests = co.ref(RequestsList);
}

// ---cut-before---
async function approveJoinRequest(
  joinRequest: JoinRequest,
  targetGroup: Group,
) {
  const account = await Account.load(joinRequest._refs.account.id);

  if (account) {
    targetGroup.addMember(account, "reader");
    joinRequest.status = "approved";

    return true;
  } else {
    return false;
  }
}
```
</CodeGroup>

