import { CodeGroup } from "@/components/forMdx";

# Vue guide

This is a step-by-step tutorial where we'll build a simple todo list app using Vue.

We'll spin up a new Vue project, set up Jazz, define our schema, and manipulate data.

See the [full example](https://github.com/gardencmp/jazz/tree/main/examples/todo-vue).

By the end of this tutorial, you will have a simple todo list app where you can log in,
create folders under your account, and add a list of todo items to each folder
which you can check off.

---

## Project setup

### Create a Vue application

Run the following command to create a new Vue application:

<CodeGroup>
```sh
npm create vue@latest
```
</CodeGroup>

Enable TypeScript and Vue Router.

<CodeGroup>
```sh
âœ” Project name: â€¦ todo-vue
âœ” Add TypeScript? â€¦ Yes
âœ” Add JSX Support? â€¦ No
âœ” Add Vue Router for Single Page Application development? â€¦ Yes
âœ” Add Pinia for state management? â€¦ No
âœ” Add Vitest for Unit Testing? â€¦ No
âœ” Add an End-to-End Testing Solution? â€º No
âœ” Add ESLint for code quality? â€º Yes
âœ” Add Prettier for code formatting? â€¦ Yes
```
</CodeGroup>

### Set up Jazz

Run the following command to install Jazz libraries:

<CodeGroup>
```bash
npm install jazz-tools jazz-browser jazz-vue
```
</CodeGroup>

## Building the app

Here's our goal: When a user logs in to the app, we want them to be able to create a new folder. Inside this folder,
they'll be able to create a list of todo items.

In Jazz, we define this data structure using a schema.

### Define your schema

A schema is defined using [CoValues](/docs/schemas/covalues), which stands for "Collaborative Values".
Think of it as JSON objects defined with a different syntax.

We'll have an array of `Folder`s. Inside each `Folder`, we'll have an array of `ToDoItem`s.

Let's define that in a new file called `schema.ts` under `src`.

<CodeGroup>
```typescript
// src/schema.ts

import { CoList, CoMap, co } from "jazz-tools";

export class ToDoItem extends CoMap {
  name = co.string;
  completed = co.boolean;
}

export class ToDoList extends CoList.Of(co.ref(ToDoItem)) {}

export class Folder extends CoMap {
  name = co.string;
  items = co.ref(ToDoList);
}
```
</CodeGroup>

You can see that we defined primitives using `co`. You can find other types [here](/docs/vue/schemas/covalues#primitive-fields).
<CodeGroup>
```typescript
name = co.string;
```
</CodeGroup>

And we defined objects using `CoMap`.

<CodeGroup>
```typescript
export class ToDoItem extends CoMap {
  name = co.string;
  completed = co.boolean;
}
```
</CodeGroup>

And we defined arrays using `CoList`.

<CodeGroup>
```typescript
export class ToDoList extends CoList.Of(co.ref(ToDoItem)) {}
```
</CodeGroup>

You can reference another CoValue using `co.ref()`.
<CodeGroup>
```typescript
export class Folder extends CoMap {
  name = co.string;
  items = co.ref(ToDoList); // *highlight*
}
```
</CodeGroup>

Now you've got the basics of CoValues. ðŸ™Œ

### Define your account schema

We want the folders to be stored in the user's account. So let's define the schema for our `Account`, and call that `ToDoAccount`.

<CodeGroup>
```typescript
// src/schema.ts

import { Account, CoList, CoMap, Group, Profile, co } from "jazz-tools";

export class ToDoItem extends CoMap { // old
  name = co.string; // old
  completed = co.boolean; // old
} // old

export class ToDoList extends CoList.Of(co.ref(ToDoItem)) {} // old

export class Folder extends CoMap { // old
  name = co.string; // old
  items = co.ref(ToDoList); // old
} // old

export class FolderList extends CoList.Of(co.ref(Folder)) {}

export class ToDoAccountRoot extends CoMap {
  folders = co.ref(FolderList);
}

export class ToDoAccount extends Account {
  profile = co.ref(Profile);
  root = co.ref(ToDoAccountRoot);

  migrate(this: ToDoAccount, creationProps?: { name: string }) {
    super.migrate(creationProps);
    if (!this._refs.root) {
      const group = Group.create({ owner: this });
      const firstFolder = Folder.create(
        {
          name: "Default",
          items: ToDoList.create([], { owner: group }),
        },
        { owner: group },
      );


      this.root = ToDoAccountRoot.create(
        {
          folders: FolderList.create([firstFolder], {
            owner: this,
          }),
        },
        { owner: this },
      );
    }
  }
}
```
</CodeGroup>


### Refactor `main.ts`

Update the `src/main.ts` file to integrate Jazz:

<CodeGroup>
```typescript
import "./assets/main.css";
import { DemoAuthBasicUI, createJazzVueApp, useDemoAuth } from "jazz-vue";
import { createApp, defineComponent, h } from "vue";
import App from "./App.vue";
import router from "./router";
import { ToDoAccount } from "./schema";

const Jazz = createJazzVueApp<ToDoAccount>({ AccountSchema: ToDoAccount });
export const { useAccount, useCoState } = Jazz;
const { JazzProvider } = Jazz;

const RootComponent = defineComponent({
  name: "RootComponent",
  setup() {
    const { authMethod, state } = useDemoAuth();

    return () => [
      h(
        JazzProvider,
        {
          auth: authMethod.value,
          peer: "wss://mesh.jazz.tools/?key=vue-todo-example-jazz@gcmp.io",
        },
        {
          default: () => h(App),
        },
      ),

      state.state !== "signedIn" &&
        h(DemoAuthBasicUI, {
          appName: "Jazz Vue Todo",
          state,
        }),
    ];
  },
});

const app = createApp(RootComponent);

app.use(router);

app.mount("#app");
```
</CodeGroup>

### Set up `router/index.ts`:

Create a basic Vue router configuration. For example:

<CodeGroup>
```typescript
import { createRouter, createWebHistory } from "vue-router";
import HomeView from "../views/HomeView.vue";

const router = createRouter({
  history: createWebHistory(import.meta.env.BASE_URL),
  routes: [
    {
      path: "/",
      name: "Home",
      component: HomeView,
    },
  ],
});

export default router;
```
</CodeGroup>

### Implement `App.vue`

Update the `App.vue` file to include logout functionality:

<CodeGroup>
```typescript
<template>
  <div class="app-container">
    <header v-if="me" class="app-header">
      <h1>Todo App</h1>
      <div class="user-section">
        <span>{{ me.profile?.name }}</span>
        <button class="logout-btn" @click="logOut">Log out</button>
      </div>
    </header>
    <main>
      <router-view />
    </main>
  </div>
</template>

<script setup lang="ts">
import { useAccount } from "./main";

const { me, logOut } = useAccount();
</script>
```
</CodeGroup>

## Subscribing to a CoValue

Subscribe to a CoValue inside `src/views/HomeView.vue`:

<CodeGroup>
```typescript
<script setup lang="ts">
import { Group, type ID } from "jazz-tools";
import { ref, toRaw, watch } from "vue";
import { computed } from "vue";
import { useAccount, useCoState } from "../main";
import { Folder, FolderList, ToDoItem, ToDoList } from "../schema";

const { me } = useAccount();

// Computed ID for the folders list
const computedFoldersId = computed(() => me.value?.root?.folders?.id);

// Load folders and nested values
const folders = useCoState(FolderList, computedFoldersId, [{ items: [{}] }]);
```
</CodeGroup>

See the full example [here](https://github.com/gardencmp/jazz/tree/main/examples/todo-vue).

## Mutating a CoValue

Here's how to create a new folder:

<CodeGroup>
```typescript
// continues previous example

const createFolder = async (name: string) => {
  // Create a group owned by the current user
  const group = Group.create({ owner: me.value });

  // Create the folder
  const newFolder = Folder.create(
    {
      name,
      items: ToDoList.create([], { owner: group }),
    },
    { owner: group },
  );

  // Add the folder to the list of folders.
  // This change is sent to all connected clients and will be synced in real time.
  folders.value?.push(newFolder);
  newFolderName.value = "";
};

```
</CodeGroup>

See the full example [here](https://github.com/gardencmp/jazz/tree/main/examples/todo-vue).
